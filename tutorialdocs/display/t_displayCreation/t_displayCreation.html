
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>t_displayCreation</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-12-12"><meta name="DC.source" content="t_displayCreation.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">t_displayCreation</a></li><li><a href="#2">Setting up basic display properties</a></li><li><a href="#3">Spectral power distribution (spd)</a></li><li><a href="#4">Gamma Table</a></li><li><a href="#5">Ambient</a></li><li><a href="#6">Pixel layout</a></li><li><a href="#7">Render function</a></li><li><a href="#8">Save and visualize</a></li></ul></div><h2>t_displayCreation<a name="1"></a></h2><pre>This tutorial explains how to create an ISET display structure using
measurement data</pre><pre>HJ/JEF, Stanford, 2015</pre><pre class="codeinput"><span class="comment">% Initialize ISET</span>
ieInit;
</pre><h2>Setting up basic display properties<a name="2"></a></h2><p>Display name This is identifier of the display instance.</p><pre class="codeinput">d.name = <span class="string">'LCD-Exmaple'</span>;

<span class="comment">% Type</span>
<span class="comment">% This field should always be 'display'</span>
d.type = <span class="string">'display'</span>;

<span class="comment">% Dispaly resolution</span>
<span class="comment">%</span>
<span class="comment">% Resolution is specified in units of pixels per inch (dpi or ppi). This</span>
<span class="comment">% field is a scalar in current ISET system, meaning that the horizontal and</span>
<span class="comment">% vertical resolutions of display are the same (which is true for most</span>
<span class="comment">% displays). Also, we assume that resolution for all primaries are the</span>
<span class="comment">% same.</span>
d.dpi = 100;

<span class="comment">% Viewing distance</span>
<span class="comment">%</span>
<span class="comment">% This field specifies the distance between the observer and the display in</span>
<span class="comment">% meters. Viewing distance is not an essential property of the display. But</span>
<span class="comment">% it is widely used in converting the image size on display to field of</span>
<span class="comment">% view. If it's unkwown or you are not using it, set it to any arbitray</span>
<span class="comment">% value</span>
d.dist = 0.5;

<span class="comment">% Emissive or Reflective</span>
<span class="comment">%</span>
<span class="comment">% This field indicate whether the display is a emissive display or</span>
<span class="comment">% reflective display. CRT, LCD, OLED are all emissive displays.</span>
d.isEmissive = true;
</pre><h2>Spectral power distribution (spd)<a name="3"></a></h2><p>Wavelength samples</p><p>This field is a column vector and contains information about which wavelengths the spectral data are sampled. The unit of this field is nm</p><pre class="codeinput">d.wave = (380:4:780)';

<span class="comment">% Spectral power distribution</span>
<span class="comment">%</span>
<span class="comment">% This field contains measurement data for averaged primary power</span>
<span class="comment">% distribution in energy units (watts/sr/m2/nm). SPD is usually measured</span>
<span class="comment">% with spectrometer. Note that the values in this field is the averaged</span>
<span class="comment">% value, which is equal to peak spd (primary chemical spd) times the fill</span>
<span class="comment">% factor of the primary</span>
<span class="comment">%</span>
<span class="comment">% Here, for simplicity, we create the display with R,G,B spd in Gaussian</span>
<span class="comment">% shapes</span>
d.spd = 4e-3 * exp(-bsxfun(@minus, d.wave, [620 520 460]).^2/1000);
</pre><h2>Gamma Table<a name="4"></a></h2><p>Gama table</p><p>Gamma table describes the relationship between the quantized digital input and normalized linear output. The number of quantized levels are referred as color bitdepth of the display. Gamma table can be measured with spectrometer. Gamma table for primaries can be different.</p><p>Here, for simplicity, we generate a display gamma table with a exponential function and assume gamma table for different primaries are the same</p><pre class="codeinput">d.gamma = repmat(linspace(0, 1, 256)'.^2.2, [1, 3]);
</pre><h2>Ambient<a name="5"></a></h2><p>SPD of display dark level</p><p>This field describes the SPD of display when all primaries are turned to lowest level. If black is black, this field should be a vector of zeros. However, for most LCD, the 'black' spd exists</p><p>Here, for simplicity, we set black to black</p><pre class="codeinput">d.ambient = zeros(length(d.wave), 1);
</pre><h2>Pixel layout<a name="6"></a></h2><p>Number of pixels in one repeating unit</p><p>For most displays, one repeating unit (dixel) contains one individually addressable primary set (pixel). However, in some displays, there could be multiple pixels in one dixel (e.g. Samsung Note series and S-strip). To see an example, you can use code   displayPlot(displayCreate('OLED-Samsung'), 'pixel image');</p><p>This field records number pixels in one dixel in [row, col] format. Here, we assume one dixel contains only one pixel</p><pre class="codeinput">d.dixel.nPixels = [1 1];

<span class="comment">% Spatial intensity distribution</span>
<span class="comment">%</span>
<span class="comment">% This field describes the relative spatial intensity of each primary</span>
<span class="comment">% within one dixel. That is, the field specifies, within one dixel, where</span>
<span class="comment">% should be red/green/blue and how bright (relative) it is. The field</span>
<span class="comment">% should be of shape MxNxn_primary and it should be normalized to have</span>
<span class="comment">%   sum(sum(d.dixel.intensitymap)) == M*N</span>
<span class="comment">%</span>
<span class="comment">% This field can be measured by highly</span>
<span class="comment">% magnified camera images.</span>
<span class="comment">%</span>
<span class="comment">% Here, we generate spatial distribution of RGB primaries with Gaussian</span>
N = 128; <span class="comment">% sampling rate in one dixel</span>
[X, Y] = meshgrid(1:N, 1:N);
cx = reshape([N/4 N/2 3*N/4], [1 1 3]); cy = N/2 * ones(1,1,3); <span class="comment">% center</span>

<span class="comment">% generate with Gaussian and normalize it</span>
img = exp(-bsxfun(@minus,X,cx).^2/(N/16)^2-bsxfun(@minus,Y,cy).^2/(N/4)^2);
d.dixel.intensitymap = N^2 * bsxfun(@rdivide, img, sum(sum(img)));

<span class="comment">% To visualize the layout, use</span>
<span class="comment">%    vcNewGraphWin; imagescRGB(d.dixel.intensitymap);</span>

<span class="comment">% Pixel control information</span>
<span class="comment">%</span>
<span class="comment">% This field describes which areas are independent addressable by different</span>
<span class="comment">% pixels in one dixel. This field should be in same shape as intensity map</span>
<span class="comment">% and the values in this field should be integers between one and number of</span>
<span class="comment">% pixels in that dixel (prod(d.dixel.nPixels)). Entry value at position</span>
<span class="comment">% (i,j,p) equals k means that the p-th primary at position (i, j) in dixel</span>
<span class="comment">% is controlled by the k-th pixel.</span>
<span class="comment">%</span>
<span class="comment">% If there is only one pixel in the dixel, this field should all be one,</span>
<span class="comment">% meaning that they are all controlled by the first (and the only) pixel.</span>
<span class="comment">%</span>
<span class="comment">% Here, because we only have one pixel in dixel, we set all control values</span>
<span class="comment">% to one</span>
d.dixel.controlmap = ones(size(d.dixel.intensitymap));
</pre><h2>Render function<a name="7"></a></h2><p>This field should be a function handle specifying how to map the image onto the display pixels.</p><p>In some complicated case, there is no obvious relationship between the input RGB image pixel values and the intensity to be shown on the display. For example, if a dispaly has four primaries (R,G,B,White), it's unclear how to assign values to primaries according to RGB image input. Thus, we need a function to specify this conversion. See render_lcd_samsung_rgbw.m for example. If pixels are interleaved in one dixel, this field should also be used (see render_oled_samsung).</p><p>If there is only one pixel in dixel, we can leave this field empty.</p><pre class="codeinput">d.dixel.renderFunc = [];
</pre><h2>Save and visualize<a name="8"></a></h2><p>For how to use display structure, see t_displayIntroduction</p><pre class="codeinput">save(fullfile(isetRootPath, <span class="string">'data'</span>, <span class="string">'displays'</span>, <span class="string">'dExample.mat'</span>), <span class="string">'d'</span>);

<span class="comment">% now we can create it</span>
d = displayCreate(<span class="string">'dExample'</span>);

<span class="comment">% have a look</span>
vcAddObject(d); displayWindow;
</pre><img vspace="5" hspace="5" src="t_displayCreation_01.png" style="width:1170px;height:648px;" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% t_displayCreation
%
%  This tutorial explains how to create an ISET display structure using
%  measurement data
%
%  HJ/JEF, Stanford, 2015

% Initialize ISET
ieInit;

%% Setting up basic display properties
% Display name
% This is identifier of the display instance.
d.name = 'LCD-Exmaple';

% Type
% This field should always be 'display'
d.type = 'display';

% Dispaly resolution
%
% Resolution is specified in units of pixels per inch (dpi or ppi). This
% field is a scalar in current ISET system, meaning that the horizontal and
% vertical resolutions of display are the same (which is true for most
% displays). Also, we assume that resolution for all primaries are the
% same.
d.dpi = 100;

% Viewing distance
%
% This field specifies the distance between the observer and the display in
% meters. Viewing distance is not an essential property of the display. But
% it is widely used in converting the image size on display to field of
% view. If it's unkwown or you are not using it, set it to any arbitray
% value
d.dist = 0.5;

% Emissive or Reflective
%
% This field indicate whether the display is a emissive display or
% reflective display. CRT, LCD, OLED are all emissive displays.
d.isEmissive = true;

%% Spectral power distribution (spd)
% Wavelength samples
%
% This field is a column vector and contains information about which
% wavelengths the spectral data are sampled. The unit of this field is nm
d.wave = (380:4:780)';

% Spectral power distribution
%
% This field contains measurement data for averaged primary power
% distribution in energy units (watts/sr/m2/nm). SPD is usually measured
% with spectrometer. Note that the values in this field is the averaged
% value, which is equal to peak spd (primary chemical spd) times the fill
% factor of the primary
%
% Here, for simplicity, we create the display with R,G,B spd in Gaussian
% shapes
d.spd = 4e-3 * exp(-bsxfun(@minus, d.wave, [620 520 460]).^2/1000);

%% Gamma Table
% Gama table
%
% Gamma table describes the relationship between the quantized digital
% input and normalized linear output. The number of quantized levels are
% referred as color bitdepth of the display. Gamma table can be measured
% with spectrometer. Gamma table for primaries can be different.
%
% Here, for simplicity, we generate a display gamma table with a
% exponential function and assume gamma table for different primaries are
% the same
d.gamma = repmat(linspace(0, 1, 256)'.^2.2, [1, 3]);

%% Ambient
% SPD of display dark level
%
% This field describes the SPD of display when all primaries are turned to
% lowest level. If black is black, this field should be a vector of zeros.
% However, for most LCD, the 'black' spd exists
%
% Here, for simplicity, we set black to black
d.ambient = zeros(length(d.wave), 1);

%% Pixel layout
% Number of pixels in one repeating unit
%
% For most displays, one repeating unit (dixel) contains one individually
% addressable primary set (pixel). However, in some displays, there could
% be multiple pixels in one dixel (e.g. Samsung Note series and S-strip).
% To see an example, you can use code
%   displayPlot(displayCreate('OLED-Samsung'), 'pixel image');
%
% This field records number pixels in one dixel in [row, col] format. Here,
% we assume one dixel contains only one pixel
d.dixel.nPixels = [1 1];

% Spatial intensity distribution
%
% This field describes the relative spatial intensity of each primary
% within one dixel. That is, the field specifies, within one dixel, where
% should be red/green/blue and how bright (relative) it is. The field
% should be of shape MxNxn_primary and it should be normalized to have 
%   sum(sum(d.dixel.intensitymap)) == M*N
%
% This field can be measured by highly
% magnified camera images.
%
% Here, we generate spatial distribution of RGB primaries with Gaussian
N = 128; % sampling rate in one dixel
[X, Y] = meshgrid(1:N, 1:N);
cx = reshape([N/4 N/2 3*N/4], [1 1 3]); cy = N/2 * ones(1,1,3); % center

% generate with Gaussian and normalize it
img = exp(-bsxfun(@minus,X,cx).^2/(N/16)^2-bsxfun(@minus,Y,cy).^2/(N/4)^2);
d.dixel.intensitymap = N^2 * bsxfun(@rdivide, img, sum(sum(img)));

% To visualize the layout, use
%    vcNewGraphWin; imagescRGB(d.dixel.intensitymap);

% Pixel control information
%
% This field describes which areas are independent addressable by different
% pixels in one dixel. This field should be in same shape as intensity map
% and the values in this field should be integers between one and number of
% pixels in that dixel (prod(d.dixel.nPixels)). Entry value at position
% (i,j,p) equals k means that the p-th primary at position (i, j) in dixel
% is controlled by the k-th pixel.
% 
% If there is only one pixel in the dixel, this field should all be one,
% meaning that they are all controlled by the first (and the only) pixel.
%
% Here, because we only have one pixel in dixel, we set all control values
% to one
d.dixel.controlmap = ones(size(d.dixel.intensitymap));

%% Render function
% This field should be a function handle specifying how to map the image
% onto the display pixels.
%
% In some complicated case, there is no obvious relationship between the
% input RGB image pixel values and the intensity to be shown on the
% display. For example, if a dispaly has four primaries (R,G,B,White), it's
% unclear how to assign values to primaries according to RGB image input.
% Thus, we need a function to specify this conversion. See
% render_lcd_samsung_rgbw.m for example. If pixels are interleaved in one
% dixel, this field should also be used (see render_oled_samsung).
%
% If there is only one pixel in dixel, we can leave this field empty.
d.dixel.renderFunc = [];

%% Save and visualize
% For how to use display structure, see t_displayIntroduction
save(fullfile(isetRootPath, 'data', 'displays', 'dExample.mat'), 'd');

% now we can create it
d = displayCreate('dExample');

% have a look
vcAddObject(d); displayWindow;
##### SOURCE END #####
--></body></html>