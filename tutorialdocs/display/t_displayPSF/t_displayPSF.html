
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>t_displayPSF</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-12-11"><meta name="DC.source" content="t_displayPSF.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>t_displayPSF</h1><!--introduction--><p>HJ is updating the display structure calls to account for display point spread functions.  The purpose of the updated structures is to allow us to have more spatially accurate descriptions of the display spectral radiance.</p><p>This script is a includes material about the PSF calculations in the new display structure.</p><p>NOTES:   1) Broken becuase ISETBIO's displayGet does not (yet) have a psf method.</p><p>(BW) May 2014</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Init</a></li><li><a href="#2">Make a harmonic image for a display with a psf</a></li><li><a href="#3">Show the display point spread functions (psfs)</a></li><li><a href="#4">Now, replace the psfs with a different shape</a></li><li><a href="#5">Display the same scene, but with a different psf for the display</a></li><li><a href="#6">Now do a similar calculation using some of the ISET tools</a></li><li><a href="#7">End</a></li></ul></div><h2>Init<a name="1"></a></h2><pre class="codeinput">ieInit
</pre><h2>Make a harmonic image for a display with a psf<a name="2"></a></h2><pre class="codeinput">x = 1:32;  <span class="comment">% Spatial samples</span>
A = 0.25;  <span class="comment">% Harmonic amplitude</span>
M = 0.5;   <span class="comment">% Mean level</span>

I = A*sin(2*pi*x/max(x)) + M;
I = repmat(I,max(x),1);
[outImage, d] = displayCompute(<span class="string">'LCD-Apple'</span>, I);
vcNewGraphWin; imagescRGB(outImage);
</pre><img vspace="5" hspace="5" src="t_displayPSF_01.png" style="width:717px;height:518px;" alt=""> <h2>Show the display point spread functions (psfs)<a name="3"></a></h2><pre class="codeinput">psfs = displayGet(d,<span class="string">'dixel intensity map'</span>);

vcNewGraphWin([],<span class="string">'tall'</span>);
<span class="keyword">for</span> ii=1:3, subplot(3,1,ii), mesh(psfs(:,:,ii)); <span class="keyword">end</span>
xlabel(<span class="string">'x position'</span>);
ylabel(<span class="string">'y position'</span>)
zlabel(<span class="string">'Relative intensity'</span>);

<span class="comment">% We need to explain the scaling and resampling of the psfs</span>
<span class="comment">% The values are carefully set up to preserve the units.  Further</span>
<span class="comment">% documentation is needed.  Note that the sum is xSize*ySize.</span>
<span class="comment">% When we change the spatial sampling, these functions change amplitude as</span>
<span class="comment">% well so that the units work out right.</span>
<span class="comment">% sum(sum(psfs(:,:,1)))</span>
</pre><img vspace="5" hspace="5" src="t_displayPSF_02.png" style="width:717px;height:1224px;" alt=""> <h2>Now, replace the psfs with a different shape<a name="4"></a></h2><pre class="codeinput"><span class="keyword">for</span> ii=1:3
    psfs(:,:,ii) = psfs(:,:,ii)';
<span class="keyword">end</span>
d2 = displaySet(d,<span class="string">'dixel intensity map'</span>,psfs);

psfs = displayGet(d2,<span class="string">'dixel intensity map'</span>);
vcNewGraphWin([],<span class="string">'tall'</span>);
<span class="keyword">for</span> ii=1:3, subplot(3,1,ii), mesh(psfs(:,:,ii)); <span class="keyword">end</span>
xlabel(<span class="string">'x position'</span>);
ylabel(<span class="string">'y position'</span>)
zlabel(<span class="string">'Relative intensity'</span>);
</pre><img vspace="5" hspace="5" src="t_displayPSF_03.png" style="width:717px;height:1224px;" alt=""> <h2>Display the same scene, but with a different psf for the display<a name="5"></a></h2><pre class="codeinput">outImage = displayCompute(d2, I);
vcNewGraphWin; imagescRGB(outImage);
</pre><img vspace="5" hspace="5" src="t_displayPSF_04.png" style="width:717px;height:518px;" alt=""> <h2>Now do a similar calculation using some of the ISET tools<a name="6"></a></h2><pre class="codeinput">imSize = [32 32];
scene = sceneCreate(<span class="string">'slanted bar'</span>,imSize);
I = sceneGet(scene,<span class="string">'rgb'</span>);
vcNewGraphWin([],<span class="string">'tall'</span>);
subplot(2,1,1), imagescRGB(displayCompute(d, I)); title(<span class="string">'Display V'</span>);
subplot(2,1,2), imagescRGB(displayCompute(d2, I)); title(<span class="string">'Display H'</span>)
</pre><img vspace="5" hspace="5" src="t_displayPSF_05.png" style="width:717px;height:1224px;" alt=""> <h2>End<a name="7"></a></h2><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% t_displayPSF
%
% HJ is updating the display structure calls to account for display point
% spread functions.  The purpose of the updated structures is to allow us
% to have more spatially accurate descriptions of the display spectral
% radiance.
%
% This script is a includes material about the PSF calculations in the new
% display structure.
%
% NOTES:
%   1) Broken becuase ISETBIO's displayGet does not (yet) have a psf method.
%
% (BW) May 2014

%% Init
ieInit

%% Make a harmonic image for a display with a psf
x = 1:32;  % Spatial samples
A = 0.25;  % Harmonic amplitude
M = 0.5;   % Mean level

I = A*sin(2*pi*x/max(x)) + M; 
I = repmat(I,max(x),1);
[outImage, d] = displayCompute('LCD-Apple', I);
vcNewGraphWin; imagescRGB(outImage);

%%  Show the display point spread functions (psfs)
psfs = displayGet(d,'dixel intensity map');

vcNewGraphWin([],'tall');
for ii=1:3, subplot(3,1,ii), mesh(psfs(:,:,ii)); end
xlabel('x position');
ylabel('y position')
zlabel('Relative intensity');

% We need to explain the scaling and resampling of the psfs
% The values are carefully set up to preserve the units.  Further
% documentation is needed.  Note that the sum is xSize*ySize.
% When we change the spatial sampling, these functions change amplitude as
% well so that the units work out right.
% sum(sum(psfs(:,:,1)))


%%  Now, replace the psfs with a different shape
for ii=1:3
    psfs(:,:,ii) = psfs(:,:,ii)';
end
d2 = displaySet(d,'dixel intensity map',psfs);

psfs = displayGet(d2,'dixel intensity map');
vcNewGraphWin([],'tall');
for ii=1:3, subplot(3,1,ii), mesh(psfs(:,:,ii)); end
xlabel('x position');
ylabel('y position')
zlabel('Relative intensity');

%%  Display the same scene, but with a different psf for the display
outImage = displayCompute(d2, I);
vcNewGraphWin; imagescRGB(outImage);

%% Now do a similar calculation using some of the ISET tools
imSize = [32 32];
scene = sceneCreate('slanted bar',imSize);
I = sceneGet(scene,'rgb');
vcNewGraphWin([],'tall');
subplot(2,1,1), imagescRGB(displayCompute(d, I)); title('Display V');
subplot(2,1,2), imagescRGB(displayCompute(d2, I)); title('Display H')

%% End
##### SOURCE END #####
--></body></html>