
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>v_DisplayLUTinversion</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2015-07-23"><meta name="DC.source" content="v_DisplayLUTinversion.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Function implementing the isetbio validation code</a></li><li><a href="#4">Initialize ISET</a></li><li><a href="#5">Some informative text</a></li><li><a href="#6">Remove the Brainard lab PTB overrides folder from the path</a></li><li><a href="#8">Compare PTB vs ISETBIO LUT inversion for three different displays</a></li><li><a href="#10">Restore original path</a></li><li><a href="#11">Save validation operations</a></li><li><a href="#12">Plot</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> varargout = v_DisplayLUTinversion(varargin)
<span class="comment">%</span>
<span class="comment">% Validate display calibration lut inversion against PTB.</span>
<span class="comment">%</span>
<span class="comment">% The two don't give exactly the same results, as the inversion methods</span>
<span class="comment">% are not identical.  In particular, the PTB routines, the way we are calling</span>
<span class="comment">% them here, fit the gamma function with a power function, which smooths things</span>
<span class="comment">% out.  (The PTB functions have many other options for how they fit gamma functions,</span>
<span class="comment">% but we are not exploring those here.)  The isetbio functions do not do the smoothing.</span>
<span class="comment">%</span>
<span class="comment">% In the graphs, the comparison is ballpark good and we are happy enough with that.</span>
<span class="comment">% We've saved out what the two do, after comparing the graphs here.</span>
<span class="comment">%</span>
<span class="comment">% See also v_IrradianceIsomerizations, v_DisplayColorConversion</span>

    varargout = UnitTest.runValidationRun(@ValidationFunction, nargout, varargin);
<span class="keyword">end</span>
</pre><h2>Function implementing the isetbio validation code<a name="2"></a></h2><pre class="codeinput"><span class="keyword">function</span> ValidationFunction(runTimeParams)
</pre><h2>Initialize ISET<a name="4"></a></h2><pre class="codeinput">    close <span class="string">all</span>; ieInit;
</pre><h2>Some informative text<a name="5"></a></h2><pre class="codeinput">    UnitTest.validationRecord(<span class="string">'SIMPLE_MESSAGE'</span>, <span class="string">'Compare isetbio and PTB display lut inversion.'</span>);
</pre><h2>Remove the Brainard lab PTB overrides folder from the path<a name="6"></a></h2><p>Uncommentnig this code from using the new BL object oriented PTB overrides.  We could include these inside of isetbio, but the risk is that whether this program worked or not would depend on whether isetbio was before or after PTB on the user's path, something we don't want to have to deal with.  Elsewhere (not in isetbio), we have established that the PTB and BrainardLab routines do the same thing (which is not surprising, as the actual calculations are done by the same underlying code in each case, just accessed differently.)</p><p>But, we don't think we need this. [removedFolderFromCurrentPath, originalPath] = removeBrainardLabPTBOverrides();</p><pre class="codeinput">    <span class="keyword">try</span>
</pre><h2>Compare PTB vs ISETBIO LUT inversion for three different displays<a name="8"></a></h2><p>and four different gamma table lengths</p><pre class="codeinput">        displaysToTest = {<span class="string">'OLED-Sony'</span>, <span class="string">'LCD-Apple'</span>, <span class="string">'CRT-Dell'</span>};
        gammaTableLengthsToTest = [128 256 1024 2048];

        <span class="comment">% Loop over displays</span>
        <span class="keyword">for</span> displayIndex = 1:numel(displaysToTest)

            <span class="comment">% Create a display object</span>
            d = displayCreate(displaysToTest{displayIndex});

            <span class="comment">% Retrieve key properties of the display</span>
            <span class="comment">%</span>
            <span class="comment">% Gamma table, remove 4-th primary, if it exists,</span>
            <span class="comment">% for testing purposes.</span>
            gammaTable = displayGet(d, <span class="string">'gamma table'</span>);
            <span class="keyword">if</span> (size(gammaTable,2) &gt; 3)
                gammaTable = gammaTable(:,1:3);
            <span class="keyword">end</span>
            originalGammaTableLength = size(gammaTable,1);
            originalSettingsValues   = linspace(0,1,originalGammaTableLength);

            <span class="comment">% Primary SPDs</span>
            <span class="comment">% Remove 4-th primary, if it exists, for testing purposes.</span>
            wave = displayGet(d, <span class="string">'wave'</span>);
            spd  = displayGet(d, <span class="string">'spd primaries'</span>);

            <span class="comment">% Screen size and DPI</span>
            dotsPerMeter = displayGet(d, <span class="string">'dots per meter'</span>);
            screenSizeInPixels = [1920 1080];

            <span class="comment">% Generate PTB-compatible calStruct describing the display</span>
            PTBcal = ptb.GeneratePsychToolboxCalStruct(<span class="keyword">...</span>
                <span class="string">'name'</span>, displayGet(d, <span class="string">'name'</span>), <span class="keyword">...</span>
                <span class="string">'gammaInput'</span>, originalSettingsValues, <span class="keyword">...</span>
                <span class="string">'gammaTable'</span>, gammaTable, <span class="keyword">...</span>
                <span class="string">'wave'</span>, wave, <span class="keyword">...</span>
                <span class="string">'spd'</span>, spd, <span class="keyword">...</span>
                <span class="string">'ambientSpd'</span>, zeros(length(wave),1), <span class="keyword">...</span>
                <span class="string">'screenSizeInPixels'</span>, screenSizeInPixels, <span class="keyword">...</span>
                <span class="string">'dotsPerMeter'</span>, dotsPerMeter <span class="keyword">...</span>
            );

            <span class="keyword">for</span> resolutionIndex = 1:numel(gammaTableLengthsToTest)
                <span class="comment">% Compute the inverse gamma table with desired resolution</span>
                nInputLevels = gammaTableLengthsToTest(resolutionIndex);

                <span class="comment">% PTB-solution</span>
                PTBcal = CalibrateFitGamma(PTBcal, nInputLevels);
                gammaMethod = 1;
                PTBcal = SetGammaMethod(PTBcal, gammaMethod, nInputLevels);
                PTBinverseGamma       = PTBcal.iGammaTable;
                settingsValues        = PTBcal.gammaInput;

                <span class="comment">% ISETBIO solution</span>
                <span class="comment">% Normalize to max of 1 for comparison with PTB</span>
                ISETBIOinverseGamma = displayGet(d, <span class="string">'inverse gamma'</span>, nInputLevels);
                ISETBIOinverseGamma = ISETBIOinverseGamma / (originalGammaTableLength-1);

                <span class="comment">% Log the data</span>
                dataStruct = struct( <span class="keyword">...</span>
                    <span class="string">'displayName'</span>, displaysToTest{displayIndex}, <span class="keyword">...</span>
                    <span class="string">'originalSettingsValues'</span>, originalSettingsValues, <span class="keyword">...</span>
                    <span class="string">'gammaTable'</span>, gammaTable, <span class="keyword">...</span>
                    <span class="string">'nInputLevels'</span>, nInputLevels, <span class="keyword">...</span>
                	<span class="string">'settingsValues'</span>, settingsValues, <span class="keyword">...</span>
                	<span class="string">'PTBinverseGamma'</span>, PTBinverseGamma, <span class="keyword">...</span>
                	<span class="string">'ISETBIOinverseGamma'</span>, ISETBIOinverseGamma <span class="keyword">...</span>
                 );

                data{displayIndex}{resolutionIndex} = dataStruct;
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        UnitTest.validationData(<span class="string">'ValidationDataStructArray'</span>, data);
</pre><pre class="codeoutput">Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
Fitting with linear interpolation
</pre><pre class="codeinput">    <span class="keyword">catch</span> err
        <span class="comment">% Restore original path and rethrow error</span>
        <span class="comment">%if (~isempty(removedFolderFromCurrentPath))</span>
        <span class="comment">%    path(originalPath);</span>
        <span class="comment">%end</span>
        rethrow(err);
    <span class="keyword">end</span>
</pre><h2>Restore original path<a name="10"></a></h2><pre class="codeinput">    <span class="comment">%if (~isempty(removedFolderFromCurrentPath))</span>
    <span class="comment">%   path(originalPath);</span>
    <span class="comment">%end</span>
</pre><h2>Save validation operations<a name="11"></a></h2><pre class="codeinput">    UnitTest.validationData(<span class="string">'inversionData'</span>, dataStruct);
</pre><h2>Plot<a name="12"></a></h2><pre class="codeinput">    <span class="keyword">if</span> (runTimeParams.generatePlots)
        h = figure(1);
        set(h, <span class="string">'Position'</span>, [10 10 1704 1196]);
        clf;

        subplotIndex = 0;
        <span class="keyword">for</span> displayIndex = 1:numel(displaysToTest)
            <span class="keyword">for</span> resolutionIndex = 1:numel(gammaTableLengthsToTest)

                dataStruct = data{displayIndex}{resolutionIndex};
                subplotIndex = subplotIndex + 1;
                subplot(numel(displaysToTest),numel(gammaTableLengthsToTest),subplotIndex);
                hold <span class="string">on</span>;

                <span class="comment">% Plot results for RED channel only</span>
                channelIndex = 1;

                <span class="comment">% original gamma</span>
                plot(dataStruct.originalSettingsValues, dataStruct.gammaTable(:,channelIndex), <span class="string">'g.'</span>);

                <span class="comment">% PTB-inverted</span>
                plot(dataStruct.settingsValues, dataStruct.PTBinverseGamma(:,channelIndex), <span class="string">'r.'</span>);

                <span class="comment">% ISETBIO-inverted</span>
                plot(dataStruct.settingsValues, dataStruct.ISETBIOinverseGamma(:,channelIndex), <span class="string">'b.'</span>);

                <span class="comment">% ISETBIO-inverted</span>
                plot(dataStruct.settingsValues, 0.5+dataStruct.PTBinverseGamma(:,channelIndex)-dataStruct.ISETBIOinverseGamma(:,channelIndex), <span class="string">'k-'</span>, <span class="string">'LineWidth'</span>, 2.0);

                hold <span class="string">off</span>;

                h_legend = legend(<span class="string">'Orig. LUT'</span>, <span class="string">'PTB inverse'</span>, <span class="string">'ISETBIO inverse'</span>, <span class="string">'0.5+(PTB-ISETBIO)'</span>, <span class="string">'Location'</span>, <span class="string">'NorthWest'</span>);
                set(h_legend,<span class="string">'FontName'</span>, <span class="string">'Menlo'</span>, <span class="string">'FontSize'</span>,12);

                set(gca, <span class="string">'XLim'</span>, [0 1], <span class="string">'YLim'</span>, [0 1], <span class="string">'XTick'</span>, [0:0.1:1.0], <span class="string">'YTick'</span>, [0:0.1:1.0], <span class="string">'FontSize'</span>, 12, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>);
                xlabel(<span class="string">'gamma in'</span>,<span class="string">'FontSize'</span>, 12, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);
                ylabel(<span class="string">'gamma out'</span>, <span class="string">'FontSize'</span>, 12, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);
                axis <span class="string">'square'</span>; box <span class="string">on</span>; grid <span class="string">on</span>;
                title(sprintf(<span class="string">'%s - (%d levels)'</span>, dataStruct.displayName, dataStruct.nInputLevels), <span class="string">'FontSize'</span>, 16, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);
                hold <span class="string">off</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="v_DisplayLUTinversion_01.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% Helper method to remove the BrainardLabPTBOverrides folder if it exists on the current path.</span>
<span class="comment">% We want to remove this override, so we can use the original PTB functions</span>
<span class="comment">% without the CalStructOBJ (which is found only on our computers).</span>
<span class="keyword">function</span> [removedFolderFromCurrentPath, originalPath] = removeBrainardLabPTBOverrides

    removedFolderFromCurrentPath = <span class="string">''</span>;
    originalPath = path;

    <span class="comment">% Folder to remove the Overrides/PTB-3 folder from the current path, if the folder exists on the path</span>
    PTBoverridesDirToRemoveFromPath = <span class="string">'/Users/Shared/Matlab/Toolboxes/BrainardLabToolbox/Overrides/PTB-3'</span>;

    <span class="comment">% determine if the PTBoverridesDirToRemoveFromPath is in the current path</span>
    pathCell = regexp(path, pathsep, <span class="string">'split'</span>);
    onPath = any(strcmpi(PTBoverridesDirToRemoveFromPath, pathCell));
    <span class="keyword">if</span> (onPath)
        rmpath(PTBoverridesDirToRemoveFromPath);
        removedFolderFromCurrentPath = PTBoverridesDirToRemoveFromPath;
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####
function varargout = v_DisplayLUTinversion(varargin)
%
% Validate display calibration lut inversion against PTB.
%
% The two don't give exactly the same results, as the inversion methods
% are not identical.  In particular, the PTB routines, the way we are calling
% them here, fit the gamma function with a power function, which smooths things
% out.  (The PTB functions have many other options for how they fit gamma functions,
% but we are not exploring those here.)  The isetbio functions do not do the smoothing.
%
% In the graphs, the comparison is ballpark good and we are happy enough with that.
% We've saved out what the two do, after comparing the graphs here.
%
% See also v_IrradianceIsomerizations, v_DisplayColorConversion

    varargout = UnitTest.runValidationRun(@ValidationFunction, nargout, varargin);
end

%% Function implementing the isetbio validation code
function ValidationFunction(runTimeParams)

    %% Initialize ISET
    close all; ieInit;
    
    %% Some informative text
    UnitTest.validationRecord('SIMPLE_MESSAGE', 'Compare isetbio and PTB display lut inversion.');
    
    %% Remove the Brainard lab PTB overrides folder from the path
    %
    % Uncommentnig this code from using the new BL object oriented PTB
    % overrides.  We could include these inside of isetbio, but the risk is
    % that whether this program worked or not would depend on whether isetbio
    % was before or after PTB on the user's path, something we don't want to
    % have to deal with.  Elsewhere (not in isetbio), we have established that
    % the PTB and BrainardLab routines do the same thing (which is not
    % surprising, as the actual calculations are done by the same underlying
    % code in each case, just accessed differently.)
    %
    % But, we don't think we need this.
    % [removedFolderFromCurrentPath, originalPath] = removeBrainardLabPTBOverrides();
    
    try
        
        %% Compare PTB vs ISETBIO LUT inversion for three different displays
        % and four different gamma table lengths
        displaysToTest = {'OLED-Sony', 'LCD-Apple', 'CRT-Dell'}; 
        gammaTableLengthsToTest = [128 256 1024 2048];
        
        % Loop over displays
        for displayIndex = 1:numel(displaysToTest)
            
            % Create a display object
            d = displayCreate(displaysToTest{displayIndex});

            % Retrieve key properties of the display
            %
            % Gamma table, remove 4-th primary, if it exists,
            % for testing purposes.
            gammaTable = displayGet(d, 'gamma table');
            if (size(gammaTable,2) > 3)
                gammaTable = gammaTable(:,1:3);
            end
            originalGammaTableLength = size(gammaTable,1);
            originalSettingsValues   = linspace(0,1,originalGammaTableLength);
            
            % Primary SPDs
            % Remove 4-th primary, if it exists, for testing purposes.
            wave = displayGet(d, 'wave');
            spd  = displayGet(d, 'spd primaries');
            
            % Screen size and DPI
            dotsPerMeter = displayGet(d, 'dots per meter');
            screenSizeInPixels = [1920 1080];
                
            % Generate PTB-compatible calStruct describing the display
            PTBcal = ptb.GeneratePsychToolboxCalStruct(...
                'name', displayGet(d, 'name'), ...
                'gammaInput', originalSettingsValues, ...
                'gammaTable', gammaTable, ...
                'wave', wave, ...
                'spd', spd, ...
                'ambientSpd', zeros(length(wave),1), ...
                'screenSizeInPixels', screenSizeInPixels, ...
                'dotsPerMeter', dotsPerMeter ...
            );
                
            for resolutionIndex = 1:numel(gammaTableLengthsToTest)
                % Compute the inverse gamma table with desired resolution
                nInputLevels = gammaTableLengthsToTest(resolutionIndex);
                
                % PTB-solution
                PTBcal = CalibrateFitGamma(PTBcal, nInputLevels);
                gammaMethod = 1;
                PTBcal = SetGammaMethod(PTBcal, gammaMethod, nInputLevels);
                PTBinverseGamma       = PTBcal.iGammaTable;
                settingsValues        = PTBcal.gammaInput;

                % ISETBIO solution
                % Normalize to max of 1 for comparison with PTB
                ISETBIOinverseGamma = displayGet(d, 'inverse gamma', nInputLevels);
                ISETBIOinverseGamma = ISETBIOinverseGamma / (originalGammaTableLength-1);
                
                % Log the data 
                dataStruct = struct( ...
                    'displayName', displaysToTest{displayIndex}, ...
                    'originalSettingsValues', originalSettingsValues, ...
                    'gammaTable', gammaTable, ...
                    'nInputLevels', nInputLevels, ...
                	'settingsValues', settingsValues, ...
                	'PTBinverseGamma', PTBinverseGamma, ...
                	'ISETBIOinverseGamma', ISETBIOinverseGamma ...
                 );
                
                data{displayIndex}{resolutionIndex} = dataStruct;
            end
        end
        
        UnitTest.validationData('ValidationDataStructArray', data);

        
    catch err
        % Restore original path and rethrow error
        %if (~isempty(removedFolderFromCurrentPath))
        %    path(originalPath);
        %end
        rethrow(err);
    end
    
    %% Restore original path
    %if (~isempty(removedFolderFromCurrentPath))
    %   path(originalPath);
    %end
    
    %% Save validation operations
    UnitTest.validationData('inversionData', dataStruct);
    
    %% Plot
    if (runTimeParams.generatePlots)
        h = figure(1);
        set(h, 'Position', [10 10 1704 1196]);
        clf;
        
        subplotIndex = 0;
        for displayIndex = 1:numel(displaysToTest)
            for resolutionIndex = 1:numel(gammaTableLengthsToTest)
                
                dataStruct = data{displayIndex}{resolutionIndex};
                subplotIndex = subplotIndex + 1;
                subplot(numel(displaysToTest),numel(gammaTableLengthsToTest),subplotIndex);
                hold on;
                
                % Plot results for RED channel only
                channelIndex = 1;
                
                % original gamma
                plot(dataStruct.originalSettingsValues, dataStruct.gammaTable(:,channelIndex), 'g.');
                
                % PTB-inverted
                plot(dataStruct.settingsValues, dataStruct.PTBinverseGamma(:,channelIndex), 'r.');
                
                % ISETBIO-inverted
                plot(dataStruct.settingsValues, dataStruct.ISETBIOinverseGamma(:,channelIndex), 'b.');
                
                % ISETBIO-inverted
                plot(dataStruct.settingsValues, 0.5+dataStruct.PTBinverseGamma(:,channelIndex)-dataStruct.ISETBIOinverseGamma(:,channelIndex), 'k-', 'LineWidth', 2.0);
                
                hold off;
                
                h_legend = legend('Orig. LUT', 'PTB inverse', 'ISETBIO inverse', '0.5+(PTB-ISETBIO)', 'Location', 'NorthWest');
                set(h_legend,'FontName', 'Menlo', 'FontSize',12);
                
                set(gca, 'XLim', [0 1], 'YLim', [0 1], 'XTick', [0:0.1:1.0], 'YTick', [0:0.1:1.0], 'FontSize', 12, 'FontName', 'Helvetica');
                xlabel('gamma in','FontSize', 12, 'FontName', 'Helvetica', 'FontWeight', 'bold');
                ylabel('gamma out', 'FontSize', 12, 'FontName', 'Helvetica', 'FontWeight', 'bold');
                axis 'square'; box on; grid on;
                title(sprintf('%s - (%d levels)', dataStruct.displayName, dataStruct.nInputLevels), 'FontSize', 16, 'FontName', 'Helvetica', 'FontWeight', 'bold');
                hold off
            end
        end
    end
    
end

% Helper method to remove the BrainardLabPTBOverrides folder if it exists on the current path.
% We want to remove this override, so we can use the original PTB functions
% without the CalStructOBJ (which is found only on our computers).
function [removedFolderFromCurrentPath, originalPath] = removeBrainardLabPTBOverrides

    removedFolderFromCurrentPath = '';
    originalPath = path;
    
    % Folder to remove the Overrides/PTB-3 folder from the current path, if the folder exists on the path
    PTBoverridesDirToRemoveFromPath = '/Users/Shared/Matlab/Toolboxes/BrainardLabToolbox/Overrides/PTB-3';
    
    % determine if the PTBoverridesDirToRemoveFromPath is in the current path
    pathCell = regexp(path, pathsep, 'split');
    onPath = any(strcmpi(PTBoverridesDirToRemoveFromPath, pathCell));
    if (onPath)
        rmpath(PTBoverridesDirToRemoveFromPath);
        removedFolderFromCurrentPath = PTBoverridesDirToRemoveFromPath;
    end
end


##### SOURCE END #####
--></body></html>